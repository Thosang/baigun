<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>ระบบเติมข้อมูลลงฟอร์ม PDF</title>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/@pdf-lib/fontkit@0.0.4/dist/fontkit.umd.min.js"></script>
    
    <style>
        body { font-family: 'Tahoma', sans-serif; padding: 30px; line-height: 1.6; }
        .container { max-width: 500px; margin: auto; border: 1px solid #ddd; padding: 20px; border-radius: 10px; }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
        button { background-color: #28a745; color: white; border: none; padding: 10px 20px; cursor: pointer; width: 100%; font-size: 16px; }
        button:hover { background-color: #218838; }
    </style>
</head>
<body>

<div class="container">
    <h3>กรอกข้อมูลลงฟอร์ม (PDF-lib)</h3>
    <label>ชื่อ-นามสกุล:</label>
    <input type="text" id="userName" placeholder="ระบุชื่อที่จะให้ไปปรากฏใน PDF">
    
    <label>รหัสนักพนักงาน/นักศึกษา:</label>
    <input type="text" id="userId" placeholder="ระบุรหัส">
    
    <button onclick="fillForm()">สร้างไฟล์ PDF จากฟอร์มต้นฉบับ</button>
</div>

<script>
    const { PDFDocument, rgb } = PDFLib;

    async function fillForm() {
        // 1. โหลดไฟล์ PDF ต้นฉบับ (ต้องวางไฟล์ไว้ใน GitHub Repository เดียวกัน)

        
                // เปลี่ยนจากเดิม:
        const url = 'template.pdf'; 
        
        // เป็นแบบนี้ (ใช้ ./ เพื่อบอกว่าอยู่ที่เดียวกัน):
        const url = './template.pdf'; 
        
        // หรือลองใส่ Log เพื่อดูว่าโหลดผ่านไหม
        const existingPdfBytes = await fetch(url)
            .then(res => {
                if (!res.ok) throw new Error('หาไฟล์ PDF ต้นฉบับไม่เจอ!');
                return res.arrayBuffer();
            })
            .catch(err => alert(err.message));
        
                

        // 2. โหลด Font ภาษาไทย (จำเป็นมากเพื่อให้พิมพ์ไทยได้)
        // แนะนำให้ใช้ไฟล์ .ttf ที่ฝากไว้บนเว็บหรือใน Repo
        const fontUrl = 'https://raw.githubusercontent.com/google/fonts/master/ofl/sarabun/Sarabun-Regular.ttf'; // ตัวอย่าง Font Itim
        const fontBytes = await fetch(fontUrl).then(res => res.arrayBuffer());

        // 3. เริ่มจัดการ PDF
        const pdfDoc = await PDFDocument.load(existingPdfBytes);
        pdfDoc.registerFontkit(fontkit);
        const thaiFont = await pdfDoc.embedFont(fontBytes);

        const pages = pdfDoc.getPages();
        const firstPage = pages[0];

        // 4. ดึงค่าจากฟอร์มหน้าเว็บ
        const name = document.getElementById('userName').value;
        const id = document.getElementById('userId').value;

        // 5. เขียนข้อความลงไปในพิกัด X, Y (ต้องลองกะระยะดู)
        // หมายเหตุ: (0,0) คือมุมซ้ายล่างของกระดาษ
        firstPage.drawText(name, {
            x: 150, // ปรับตำแหน่งตามฟอร์มของคุณ
            y: 650,
            size: 18,
            font: thaiFont,
            color: rgb(0, 0, 0),
        });

        firstPage.drawText(id, {
            x: 150,
            y: 600,
            size: 18,
            font: thaiFont,
            color: rgb(0, 0, 0),
        });

        // 6. ส่งไฟล์ให้ผู้ใช้ดาวน์โหลด
        const pdfBytes = await pdfDoc.save();
        const blob = new Blob([pdfBytes], { type: 'application/pdf' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'filled_form.pdf';
        link.click();
    }
</script>

</body>
</html>



